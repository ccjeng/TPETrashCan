{"version":3,"sources":["main.js"],"names":["getLocation","successCallback","position","currentLocationLatitude","coords","latitude","currentLocationLongitude","longitude","map","panTo","google","maps","LatLng","errorCallback","error","errorTypes",1,2,3,"alert","code","console","log","message","navigator","geolocation","option","enableAcuracy","maximumAge","timeout","getCurrentPosition","initMap","mapOptions","center","lat","lng","zoom","mapTypeId","MapTypeId","ROADMAP","Map","document","getElementById","Parse","initialize","defaultLocationLatitude","defaultLocationLongitude","mc","result","processCallback","res","concat","length","process","id","i","addMarker","MarkerClusterer","markers","gridSize","maxZoom","skip","query","Query","greaterThan","limit","ascending","find","then","image","data","marker","Marker","get","title","icon","infowindow","InfoWindow","content","push","event","addListener","e","this","open"],"mappings":"AAYA,QAAAA,eAaA,QAAAC,GAAAC,GACAC,wBAAAD,EAAAE,OAAAC,SACAC,yBAAAJ,EAAAE,OAAAG,UAGAC,IAAAC,MAAA,GAAAC,QAAAC,KAAAC,OAAAT,wBAAAG,2BAGA,QAAAO,GAAAC,GACA,GAAAC,IACA,EAAA,SACAC,EAAA,cACAC,EAAA,WACAC,EAAA,SAEAC,OAAAJ,EAAAD,EAAAM,OACAC,QAAAC,IAAA,QAAAR,EAAAM,KAAA,IAAAN,EAAAS,SA5BA,GAAAC,UAAAC,YAAA,CACA,GAAAC,IACAC,eAAA,EACAC,WAAA,EACAC,QAAA,IAEAL,WAAAC,YAAAK,mBAAA7B,EAAAY,EAAAa,OAGAP,OAAA,kBAyBA,QAAAY,WACA/B,aAEA,IAAAgC,IACAC,QAAAC,IAAA/B,wBAAAgC,IAAA7B,0BACA8B,KAAA,GACAC,UAAA3B,OAAAC,KAAA2B,UAAAC,QAGA/B,KAAA,GAAAE,QAAAC,KAAA6B,IAAAC,SAAAC,eAAA,OAAAV,GArDAW,MAAAC,WAAA,2CAAA,2CAGA,IAAAC,yBAAA,WACAC,yBAAA,YAEA3C,wBAAA0C,wBACAvC,yBAAAwC,yBAoCAtC,IAeAuC,GACAC,UACAC,gBAAA,SAAAC,GAEA,GADAF,OAAAA,OAAAG,OAAAD,GACA,KAAAA,EAAAE,OAEA,WADAC,SAAAH,EAAAA,EAAAE,OAAA,GAAAE,GAMA,KAAA,GAAAC,GAAA,EAAAA,EAAAP,OAAAI,OAAAG,IAEAC,UAAAR,OAAAO,GAGAR,IAAA,GAAAU,iBAAAjD,IAAAkD,SAAAC,SAAA,GAAAC,QAAA,MAIAP,QAAA,SAAAQ,GACA,GAAAC,GAAA,GAAAnB,OAAAoB,MAAA,YAEAF,IACAC,EAAAE,YAAA,WAAAH,GAEAC,EAAAG,MAAA,KACAH,EAAAI,UAAA,YACAJ,EAAAK,OAAAC,KAAA,SAAAlB,GACAD,gBAAAC,IACA,SAAApC,GACAO,QAAAC,IAAA,UAAAR,EAAAM,KAAA,IAAAN,EAAAS,WAGA8B,UAAA,EAWA,IAAAK,YACAW,MAAA,cAEAb,UAAA,SAAAc,GAEA,GAAAC,GAAA,GAAA7D,QAAAC,KAAA6D,QACAtE,SAAA,GAAAQ,QAAAC,KAAAC,OAAA0D,EAAAG,IAAA,YAAApE,SAAAiE,EAAAG,IAAA,YAAAlE,WACAC,IAAAA,IACAkE,MAAAJ,EAAAG,IAAA,QAAAH,EAAAG,IAAA,WACAE,KAAAN,OAGAE,GAAAK,WAAA,GAAAlE,QAAAC,KAAAkE,YACAC,QAAA,OAAAR,EAAAG,IAAA,UAAA,2FAEAH,EAAAG,IAAA,YAAApE,SAAA,IAAAiE,EAAAG,IAAA,YAAAlE,UAAA,yCACA+D,EAAAG,IAAA,QAAAH,EAAAG,IAAA,WAAA,UAIAf,QAAAqB,KAAAR,GAEA7D,OAAAC,KAAAqE,MAAAC,YAAAV,EAAA,QAAA,SAAAW,GACA1E,IAAAC,MAAA0E,KAAAjF,UAGAiF,KAAAP,WAAAQ,KAAA5E,IAAA+D","file":"all.min.js","sourcesContent":["\n//initialize\n//Parse.$ = jQuery;\nParse.initialize('5fzYdG6YMpMPKBNSqvzhEL1OVoXgcVvlCAghW09Q', 'NK9ycOzWNik9d6axOAndjYXwRuycfX2qTIyidyxV');\n\n//Get user location\nvar defaultLocationLatitude = 25.0339031;\nvar defaultLocationLongitude = 121.5645098;\n\nvar currentLocationLatitude = defaultLocationLatitude;\nvar currentLocationLongitude = defaultLocationLongitude;\n \nfunction getLocation() {\n  if (navigator.geolocation) {\n        var option={\n            enableAcuracy:false,\n            maximumAge:0,\n            timeout:600000\n        };\n        navigator.geolocation.getCurrentPosition(successCallback, errorCallback, option);\n  }\n  else {\n        alert('此瀏覽器不支援地理定位功能!');\n  }\n\n  function successCallback(position) {\n        currentLocationLatitude = position.coords.latitude;\n        currentLocationLongitude = position.coords.longitude;    \n\n        //console.log('successCallback = ' + currentLocationLatitude + ',' + currentLocationLongitude);\n        map.panTo( new google.maps.LatLng(currentLocationLatitude, currentLocationLongitude) );\n\n  }\n  function errorCallback(error) {\n        var errorTypes={\n              0:\"不明原因錯誤\",\n              1:\"使用者拒絕提供位置資訊\",\n              2:\"無法取得位置資訊\",\n              3:\"位置查詢逾時\"\n              };\n        alert(errorTypes[error.code]);\n        console.log(\"code=\" + error.code + \" \" + error.message); //開發測試時用\n  }\n}\n\n\nvar map;\nfunction initMap() {\n  getLocation();\n\n  var mapOptions = {\n      center: {lat: currentLocationLatitude, lng: currentLocationLongitude},\n      zoom: 17,\n      mapTypeId: google.maps.MapTypeId.ROADMAP\n  };\n\n  map = new google.maps.Map(document.getElementById(\"map\"), mapOptions);\n\n}\n\n\nvar mc;\nvar result = [];\nvar processCallback = function(res) {\n                result = result.concat(res);\n                if (res.length == 1000) {\n                  process(res[res.length-1].id);\n                  return;\n                }   \n                //console.log(result.length);\n\n                //To print all results\n                for(var i=0;i<result.length;i++){\n                        //console.log(result[i].id);\n                        addMarker(result[i]);\n                }\n\n                mc = new MarkerClusterer(map, markers, {gridSize: 80, maxZoom: 14});\n\n}\n\nvar process = function(skip) {\n    var query = new Parse.Query(\"TPE201509\");\n\n            if (skip) {\n              query.greaterThan(\"objectId\", skip);\n            }\n            query.limit(1000);\n            query.ascending(\"objectId\");\n            query.find().then(function querySuccess(res) {\n                processCallback(res);\n            }, function queryFailed(error) {\n                console.log('Error: ' + error.code + ' ' + error.message);\n            });\n}\nprocess(false);\n\n//\n\n/*\ngoogle.maps.InfoWindow.prototype.isOpen = function(){\n  var map = this.getMap();\n  return (map !== null && typeof map !== \"undefined\");\n}*/\n\n\nvar markers = [];\nvar image = 'img/pin.png';\n\nvar addMarker = function(data){\n\n  var marker = new google.maps.Marker({\n        position : new google.maps.LatLng(data.get('location').latitude, data.get('location').longitude), \n        map : map,\n        title : data.get('road') + data.get('address'),\n        icon : image\n  });\n\n  marker.infowindow = new google.maps.InfoWindow({\n      content: '<h4>'+ data.get('region') + '</h4>'\n          + '<p><img src=\"https://maps.googleapis.com/maps/api/streetview?size=400x180&location='\n          + data.get('location').latitude +','+data.get('location').longitude+'&fov=90&heading=180&pitch=10\"></p>'\n          + '<h4>' + data.get('road') + data.get('address') + '</h4>'\n          \n  });\n\n  markers.push(marker);\n\n  google.maps.event.addListener(marker, 'click', function(e){\n      map.panTo( this.position );\n      //map.setZoom(17);\n      //for (var i = 0; i < markers.length; i++) { if(markers[i].infowindow.isOpen()){ markers[i].infowindow.close(); } }\n      this.infowindow.open(map, marker);\n  });\n};\n\n\n"],"sourceRoot":"/source/"}